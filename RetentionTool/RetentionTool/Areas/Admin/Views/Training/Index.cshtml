@using PagedList.Mvc
@model PagedList.IPagedList<RetentionTool.Models.AssignResourceViewModel>
@{
    ViewBag.Title = "Schedule Topics";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutMain.cshtml";
    //  var details = ViewBag.details;
    var Training = ViewBag.Training;
    var del = ViewBag.del;
}
<script src="~/Scripts/assets/js/vendor/jquery-2.1.4.min.js"></script>
@*<script src="../Scripts/assets/js/plugins.js"></script>*@

@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
@*<style>
        /* Popup container - can be anything you want */
        .popup {
            position: relative;
            display: inline-block;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

            /* The actual popup */
            .popup .popuptext {
                visibility: hidden;
                width: 160px;
                background-color: #fff;
                color: #555;
                text-align: center;
                border-radius: 6px;
                padding: 8px 0;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                margin-left: -80px;
                font-size: 1rem
            }

                /* Popup arrow */
                .popup .popuptext::after {
                    content: "";
                    position: absolute;l
                    top: 100%;
                    left: 50%;
                    margin-left: -5px;
                    border-width: 5px;
                    border-style: solid;
                    border-color: #555 transparent transparent transparent;
                }

            /* Toggle this class - hide and show the popup */
            .popup .show {
                visibility: visible;
                -webkit-animation: fadeIn 1s;
                animation: fadeIn 1s;
            }
    </style>*@


@*<script>
        // When the user clicks on div, open the popup
        function myFunction(id) {

            // alert(id);
            var assresid = id;
            // alert(id);'
            //if ($('.popuptext').show()) {
            //    $('.popuptext').hide();
            //}

            $("#myPopup-"+id).html("");
            $.ajax(
                {

                    url: '/Training/Empdetails',
                    type: 'POST',
                    datatype: 'application/json',
                    contentType: 'application/json',
                    data: JSON.stringify({ assId: assresid }),
                    success: function (result) {
                        $.each(result, function (i, empname) {
                            $("#myPopup-" + id).append("<h2 style='font-size:18px'>" + empname.Name + "</h2>")
                        });
                    },
                    error: function () { alert("Something Gone Wrong") },
                });
            var popup = document.getElementById("myPopup-" + id);

            popup.classList.toggle("show");
           // $('.popuptext').show();
        }
    </script>*@

@*<div id='myModal' class='modal'>
        <div class="modal-dialog">
            <div class="modal-content">
                <div id='myModalContent'></div>
            </div>
        </div>

    </div>*@

@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>
        <script src="~/Scripts/bootstrap.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>*@
@*<script>

            $(function () {
                $(".anchorDetail").click(function () {

                    var $buttonClicked = $(this);
                    var id = $buttonClicked.attr('data-id');
                    // alert(id);
                    var options = { "backdrop": "static", keyboard: true };
                    $.ajax({
                        type: "GET",
                        url: '/Training/Empdetails',
                        contentType: "application/json; charset=utf-8",
                        data: { "assId": id },
                        datatype: "json",
                        success: function (data) {
                            // $("#myPopup-" + id).append("<h2 style='font-size:18px'>" + empname.Name + "</h2>")

                            $('#myModalContent').html(data);
                            $('#myModal').modal(options);
                            $('#myModal').modal('show');

                        },
                        error: function () {
                            alert("Dynamic content load failed.");
                        }
                    });
                });

                $("#closbtn").click(function () {
                    $('#myModal').modal('hide');
                });

            });
        </script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />*@

<div class="breadcrumbs">
    <div class="col-sm-6">
        <div class="page-header float-left">
            <div class="page-title">
                <h1> Topics</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-6">
        <div class="page-header float-right">
            <div class="page-title">
                <ol class="breadcrumb text-right" style="background-color:white">
                    <li><a href="@Url.Action("Index", "AdminDashboard")">Dashboard /</a></li>
                    <li><a href="@Url.Action("Index", "Training")">Topics /</a></li>
                    <li class="active"> Index </li>
                </ol>
            </div>
        </div>
    </div>
</div>


@if (Model.Count > 0)
{



    <div class="container">
        <table class="table table-striped">
            <tr>
                <th style="display:none">@Html.DisplayName("AssignResource_Id")</th>
                <th>@Html.DisplayName("Project Name")</th>
                <th style="display:none">@Html.DisplayName("Module_Id")</th>
                <th>@Html.Label("Module Name")</th>
                <th>@Html.Label("Employees Name")</th>
                <th>@Html.Label("From Date")</th>
                <th>@Html.Label("To Date")</th>
                <th>@Html.Label("Actions")</th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td style="display:none">@item.Id</td>
                    <td>@item.projectname</td>
                    <td style="display:none">@item.Module_Id</td>
                    <td>@item.modulename</td>

                    <td>
                        <div class="animated">
                            @*<div class="card-body">*@
                            @*<button type="button" class="btn btn-secondary mb-1" data-toggle="modal" data-target="#smallmodal" onclick="myPopupFun(@item.Id)">
                                    Employee List
                                </button>*@
                            <p data-toggle="modal" data-target="#smallmodal" onclick="myPopupFun(@item.Id)">
                                Employee List
                            </p>
                            <div class="modal fade show" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" style="display: none; padding-right: 17px;">
                                <div class="modal-dialog modal-sm" role="document">
                                    <div class="modal-content" style="left: 100px;top: 140px;">
                                        <div class="modal-header">
                                            <p class="modal-title" style='font-size:16px' id="smallmodalLabel">Employee List</p>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">×</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>
                                                @*My Popup*@
                                            </p>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            @*</div>*@


                        </div>
                        @*<a href="javascript:;" class="anchorDetail" id="myPopup-@item.Id" data-id="@item.Id" onclick="myPopupFun(@item.Id)">List Employee</a>*@
                    </td>

                    @{DateTime? fromdate = null;
                        DateTime? todate = null;
                    }

                    @{ bool added = false;
                        int trainerid = 0;}
                    @foreach (var training in Training)
                    {
                        if (item.Id == training.AssignResource_Id)
                        {
                            fromdate = training.FromDate;
                            todate = training.ToDate;
                            added = true;
                            trainerid = training.Id;
                        }
                    }
                    <td>@fromdate</td>
                    <td>@todate</td>
                    <td>
                        @if (added == true)
                        {
                            @Html.ActionLink(" ", "Edit", new { id = @trainerid }, new { @class = "ti-pencil" })
                            @Html.ActionLink(" ", "Delete", new { id = @trainerid }, new { @class = "ti-trash" })
                        }
                        else
                        {
                            <a href='@Url.Action("Create", "Training",new { moduleid=@item.Module_Id,assignresid=@item.Id})'>Add Details</a>
                            <a></a>
                        }

                    </td>

                </tr>
            }

        </table>

    </div>
    <div id="container" style="margin-left: 20px">
        <p></p>
        <p></p>
        <div class="pagination" style="margin-left: 400px">
            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)

            of @Model.PageCount
        </div>
        <div class="pagination" style="margin-left: 0px;">
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }), new PagedListRenderOptions() { Display = PagedListDisplayMode.IfNeeded, DisplayPageCountAndCurrentLocation = false })
            @*//PagedListRenderOptions.OnlyShowFivePagesAtATime })*@
        </div>

    </div>


}
else
{
    <div class="card-body" style="color:red;"><b>No Record Found</b></div>
}


<script type="text/javascript">
    function myPopupFun(id) {
        $(".modal-body p").remove();
        //$("#dialog").dialog({
        //    autoOpen: false,
        //    modal: true,
        //    title: "View Details"
        //});
        //$("#myPopup-" + id).click(function () {

        //  var $buttonClicked = $(this);
        //  var id = $buttonClicked.attr('data-id');
        //  alert(id);
        $.ajax({
            type: "GET",
            url: '/Admin/Training/Empdetails',
            contentType: "application/json; charset=utf-8",
            data: { "assId": id },
            datatype: "json",
            success: function (result) {

                $.each(result, function (i, empname) {
                    $(".modal-body").append("<p style='font-size:14px'>" + empname.Name + "</p>")
                });
            },
            failure: function (response) {
                alert(response.responseText);
            },
            error: function (response) {
                alert(response.responseText);
            }
        });
        //});
    };
</script>
